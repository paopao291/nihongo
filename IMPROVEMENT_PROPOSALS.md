# 予測アルゴリズムの改善提案

## 1. より高精度な形状マッチング

### 現状の問題
- 単純な点ごとの距離（等間隔リサンプリング後）
- ストロークの形状の「本質的な違い」を捉えきれていない

### 改善案

#### A. Fréchet距離の導入
```javascript
// 2つの曲線の最大最小距離を評価
function frechetDistance(stroke1, stroke2) {
    // より正確に形状の類似度を評価
    // 「お」と「む」のような似た形状でも違いを検出
}
```

#### B. 曲率（Curvature）ベースの評価
```javascript
// ストロークの各点での曲率を計算
function curvatureAt(stroke, index) {
    // 3点を使って曲率を計算
    // 形状の「曲がり具合」を評価
}
```

#### C. より多くの特徴点での評価
- 現在: 12-20点にリサンプリング
- 改善: より多くの点（30-50点）で評価
- 特に曲線部分では点の密度を上げる

## 2. 方向評価の強化

### 現状の問題
- 始点→終点の直線方向のみ
- 途中の方向変化が無視される

### 改善案

#### A. 複数の方向セグメントで評価
```javascript
function multiDirectionSimilarity(userStroke, templateStroke) {
    // ストロークを複数のセグメントに分割
    // 各セグメントの方向を評価
    // 重み付け平均で最終スコア
}
```

#### B. 方向ベクトルの変化率
```javascript
function directionChangeRate(stroke) {
    // 各点での方向ベクトルの変化を計算
    // 「お」と「む」で異なる方向変化パターンを検出
}
```

## 3. より精密な膨らみ方評価

### 現状の問題
- 特徴点（中間点、3/4地点）の位置比較のみ
- 細かい形状の違いを捉えきれない

### 改善案

#### A. 曲率プロファイル
```javascript
function curvatureProfile(stroke) {
    // 各点での曲率を計算
    // プロファイル（分布）を比較
    // 「お」は右下に膨らむ、「む」は左下に膨らむ → 曲率パターンが異なる
}
```

#### B. 領域分割による評価
```javascript
function regionBasedComparison(userStroke, templateStroke) {
    // ストロークを8方向（時計回り）の領域に分割
    // 各領域の点の密度を比較
    // 「膨らみ」の方向をより正確に判定
}
```

## 4. マルチスケール評価

### 現状の問題
- 単一スケール（12-20点）での評価のみ

### 改善案
```javascript
function multiScaleEvaluation(userStroke, templateStroke) {
    // 複数のスケール（粗い→細かい）で評価
    // 全体の形状と細部の形状を別々に評価
    // スコアを統合
}
```

## 5. 学習ベースの重み付け

### 現状の問題
- 手動で設定した重み（経験則ベース）

### 改善案
- 実際のデータから最適な重みを学習
- 文字ごとに異なる重みを設定
- 「お」と「む」では、膨らみ方の重みを大きくするなど

## 6. デバッグ・可視化機能

### 現状の問題
- なぜ「む」が「お」より高スコアなのか分からない

### 改善案
```javascript
function debugPrediction(userStrokes, topChars) {
    // 各指標のスコアを出力
    // 可視化: どの部分が一致/不一致か表示
    // 開発者が問題を特定しやすい
}
```

## 優先順位

### 短期（すぐに効果がある）
1. **膨らみ方評価の強化** - 曲率プロファイルの導入
2. **方向評価の強化** - 複数セグメントでの評価
3. **デバッグ機能** - 問題の特定を容易に

### 中期（精度向上）
1. **Fréchet距離** - より正確な形状マッチング
2. **マルチスケール評価** - 全体と細部の両方を評価

### 長期（さらなる改善）
1. **機械学習** - 重みの自動最適化
2. **書き順の柔軟性** - 順序が違っても対応

## 実装の簡単さ vs 精度のトレードオフ

| 手法 | 実装の簡単さ | 精度向上 | 推奨度 |
|------|------------|---------|--------|
| 曲率プロファイル | ★★★ | ★★ | 高 |
| 複数セグメント方向評価 | ★★ | ★★ | 高 |
| Fréchet距離 | ★ | ★★★ | 中 |
| 機械学習 | ★ | ★★★ | 低（複雑すぎる） |

**推奨**: まずは曲率プロファイルと複数セグメント方向評価を実装するのが現実的
